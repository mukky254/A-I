<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brian Agallo - AI Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #10a37f;
            --primary-dark: #0d8c6c;
            --primary-light: #e6f7f3;
            --chat-bg: #ffffff;
            --message-user-bg: #f7f7f8;
            --message-bot-bg: #ffffff;
            --message-user-border: #e5e5e5;
            --message-bot-border: #e5e5e5;
            --text-primary: #343541;
            --text-secondary: #6e6e80;
            --text-muted: #8e8ea0;
            --border: #d9d9e3;
            --input-bg: #ffffff;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background-color: var(--chat-bg);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            flex-direction: column;
        }
        
        /* Header Styles */
        .chat-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .chat-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .new-chat-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .new-chat-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .model-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .model-selector select {
            background-color: white;
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 14px;
            outline: none;
            cursor: pointer;
        }
        
        /* Main Chat Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background-color: var(--chat-bg);
            overflow: hidden;
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            background-color: var(--chat-bg);
        }
        
        .message {
            display: flex;
            gap: 16px;
            max-width: 100%;
            line-height: 1.6;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            font-size: 14px;
        }
        
        .user-avatar {
            background: linear-gradient(135deg, #10a37f, #0d8c6c);
            color: white;
        }
        
        .bot-avatar {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }
        
        .message-content {
            flex: 1;
            max-width: calc(100% - 48px);
        }
        
        .message-bubble {
            padding: 16px 20px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            position: relative;
            line-height: 1.6;
            font-size: 15px;
        }
        
        .user-message .message-bubble {
            background-color: var(--primary-light);
            border: 1px solid var(--message-user-border);
            border-bottom-right-radius: 4px;
            color: var(--text-primary);
        }
        
        .bot-message .message-bubble {
            background-color: var(--message-bot-bg);
            border: 1px solid var(--message-bot-border);
            border-bottom-left-radius: 4px;
            color: var(--text-primary);
        }
        
        .message-sender {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .message-time {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
            text-align: right;
        }
        
        .bot-message .message-time {
            text-align: left;
        }
        
        /* Input Area */
        .input-container {
            padding: 24px;
            position: relative;
            background-color: white;
            border-top: 1px solid var(--border);
            flex-shrink: 0;
        }
        
        .input-wrapper {
            position: relative;
            max-width: 768px;
            margin: 0 auto;
            background-color: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        
        .user-input {
            width: 100%;
            padding: 16px 52px 16px 16px;
            background-color: var(--input-bg);
            border: none;
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
            resize: none;
            outline: none;
            line-height: 1.5;
            max-height: 200px;
            min-height: 56px;
        }
        
        .user-input:focus {
            border-color: var(--primary);
        }
        
        .input-buttons {
            position: absolute;
            right: 12px;
            bottom: 12px;
            display: flex;
            gap: 8px;
        }
        
        .input-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .input-btn:hover {
            color: var(--text-primary);
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .send-btn {
            background-color: var(--primary);
            color: white;
        }
        
        .send-btn:hover {
            background-color: var(--primary-dark);
            color: white;
        }
        
        .send-btn:disabled {
            background-color: var(--border);
            cursor: not-allowed;
        }
        
        /* Reasoning Panel */
        .reasoning-panel {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 320px;
            background-color: white;
            border-left: 1px solid var(--border);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.05);
            z-index: 10;
        }
        
        .reasoning-panel.open {
            transform: translateX(0);
        }
        
        .reasoning-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: white;
        }
        
        .reasoning-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }
        
        .close-reasoning {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-reasoning:hover {
            color: var(--text-primary);
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .reasoning-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        
        .reasoning-step {
            margin-bottom: 16px;
            padding: 16px;
            background-color: white;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            box-shadow: var(--shadow);
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .step-time {
            color: var(--text-muted);
            font-size: 12px;
        }
        
        .step-content {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        /* Status and Typing Indicators */
        .status-bar {
            padding: 12px 24px;
            background-color: white;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-muted);
            flex-shrink: 0;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--primary);
        }
        
        .status-dot.thinking {
            background-color: #f59e0b;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-muted);
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--text-muted);
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        .toggle-reasoning {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .toggle-reasoning:hover {
            color: var(--text-primary);
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .welcome-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .welcome-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 40px;
            max-width: 600px;
            line-height: 1.6;
        }
        
        .capabilities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 40px;
            width: 100%;
            max-width: 600px;
        }
        
        .capability-item {
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            border: 1px solid var(--border);
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .capability-item:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .capability-icon {
            font-size: 24px;
            margin-bottom: 12px;
            color: var(--primary);
        }
        
        .capability-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .capability-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        .start-chatting {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .start-chatting:hover {
            background-color: var(--primary-dark);
        }
        
        .hidden {
            display: none;
        }
        
        /* Scrollbar Styling */
        .messages-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .messages-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .messages-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        .messages-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .reasoning-panel {
                width: 100%;
            }
            
            .messages-container {
                padding: 16px;
            }
            
            .input-container {
                padding: 16px;
            }
            
            .capabilities-grid {
                grid-template-columns: 1fr;
            }
            
            .chat-header {
                padding: 12px 16px;
            }
            
            .header-left {
                gap: 12px;
            }
            
            .chat-title {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="chat-header">
            <div class="header-left">
                <button class="new-chat-btn" id="new-chat-btn">
                    <i class="fas fa-plus"></i> New Chat
                </button>
                <div class="chat-title" id="active-chat-title">Brian Agallo</div>
            </div>
            <div class="model-selector">
                <label>Model:</label>
                <select id="model-select">
                    <option value="llama-3.1-8b-instant">Llama 3.1 8B Instant</option>
                    <option value="llama-3.1-70b-versatile">Llama 3.1 70B Versatile</option>
                    <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                    <option value="gemma2-9b-it">Gemma2 9B</option>
                </select>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Welcome Screen (shown when no chat is active) -->
            <div class="welcome-screen" id="welcome-screen">
                <div class="welcome-title">Brian Agallo</div>
                <div class="welcome-subtitle">Your professional AI assistant with advanced reasoning capabilities. I can help with analysis, problem-solving, research, and much more.</div>
                
                <div class="capabilities-grid">
                    <div class="capability-item" data-prompt="Help me analyze this business problem...">
                        <div class="capability-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="capability-title">Business Analysis</div>
                        <div class="capability-desc">Strategic planning and decision support</div>
                    </div>
                    <div class="capability-item" data-prompt="Explain this technical concept...">
                        <div class="capability-icon"><i class="fas fa-code"></i></div>
                        <div class="capability-title">Technical Explanations</div>
                        <div class="capability-desc">Clear breakdowns of complex topics</div>
                    </div>
                    <div class="capability-item" data-prompt="Help me draft a professional email about...">
                        <div class="capability-icon"><i class="fas fa-envelope"></i></div>
                        <div class="capability-title">Content Creation</div>
                        <div class="capability-desc">Writing and editing assistance</div>
                    </div>
                    <div class="capability-item" data-prompt="Research the latest developments in...">
                        <div class="capability-icon"><i class="fas fa-search"></i></div>
                        <div class="capability-title">Research & Analysis</div>
                        <div class="capability-desc">In-depth information gathering</div>
                    </div>
                </div>
                
                <button class="start-chatting" id="start-chatting">Start Chatting</button>
            </div>
            
            <!-- Chat Interface (hidden initially) -->
            <div id="chat-interface" class="hidden">
                <div class="messages-container" id="messages-container">
                    <!-- Messages will be added here -->
                </div>
                
                <div class="input-container">
                    <div class="input-wrapper">
                        <textarea class="user-input" id="user-input" placeholder="Message Brian Agallo..." rows="1"></textarea>
                        <div class="input-buttons">
                            <button class="input-btn" id="voice-btn" title="Voice Input">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="input-btn send-btn" id="send-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="status-bar">
                    <div class="status">
                        <div class="status-dot" id="status-dot"></div>
                        <span id="status-text">Ready for your input</span>
                    </div>
                    <div class="typing-indicator" id="typing-indicator" style="display: none;">
                        <span>Brian is thinking</span>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                    <button class="toggle-reasoning" id="toggle-reasoning">Show Reasoning</button>
                </div>
            </div>
        </div>
        
        <!-- Reasoning Panel -->
        <div class="reasoning-panel" id="reasoning-panel">
            <div class="reasoning-header">
                <div class="reasoning-title">
                    <i class="fas fa-brain"></i> Brian's Reasoning Process
                </div>
                <button class="close-reasoning" id="close-reasoning">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="reasoning-content" id="reasoning-content">
                <div class="reasoning-step">
                    <div class="step-header">
                        <span>System Initialized</span>
                        <span class="step-time" id="current-time"></span>
                    </div>
                    <div class="step-content">Brian Agallo is ready. Waiting for user input to begin reasoning process.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const messagesContainer = document.getElementById('messages-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const voiceBtn = document.getElementById('voice-btn');
        const statusText = document.getElementById('status-text');
        const statusDot = document.getElementById('status-dot');
        const typingIndicator = document.getElementById('typing-indicator');
        const reasoningContent = document.getElementById('reasoning-content');
        const reasoningPanel = document.getElementById('reasoning-panel');
        const toggleReasoningBtn = document.getElementById('toggle-reasoning');
        const closeReasoningBtn = document.getElementById('close-reasoning');
        const currentTimeEl = document.getElementById('current-time');
        const modelSelect = document.getElementById('model-select');
        const newChatBtn = document.getElementById('new-chat-btn');
        const welcomeScreen = document.getElementById('welcome-screen');
        const chatInterface = document.getElementById('chat-interface');
        const startChattingBtn = document.getElementById('start-chatting');
        const activeChatTitle = document.getElementById('active-chat-title');
        const capabilityItems = document.querySelectorAll('.capability-item');
        
        // State management
        let currentChatId = null;
        let chats = {};
        let conversationHistory = [];
        let isListening = false;
        
        // API Configuration for Groq
        const GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions";
        const API_KEY = "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";
        
        // Available Groq Models
        const GROQ_MODELS = {
            "llama-3.1-8b-instant": "llama-3.1-8b-instant",
            "llama-3.1-70b-versatile": "llama-3.1-70b-versatile", 
            "mixtral-8x7b-32768": "mixtral-8x7b-32768",
            "gemma2-9b-it": "gemma2-9b-it"
        };
        
        // Initialize the app
        function initApp() {
            updateTime();
            setInterval(updateTime, 1000);
            
            // Load any saved chats from localStorage
            loadChats();
            
            // Set up event listeners
            setupEventListeners();
        }
        
        // Update current time
        function updateTime() {
            const now = new Date();
            currentTimeEl.textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Auto-resize textarea
            userInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Send message on Enter (without Shift)
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Send button
            sendBtn.addEventListener('click', sendMessage);
            
            // Voice button
            voiceBtn.addEventListener('click', toggleVoiceRecognition);
            
            // Reasoning panel controls
            toggleReasoningBtn.addEventListener('click', toggleReasoningPanel);
            closeReasoningBtn.addEventListener('click', closeReasoningPanel);
            
            // New chat button
            newChatBtn.addEventListener('click', createNewChat);
            
            // Start chatting button
            startChattingBtn.addEventListener('click', createNewChat);
            
            // Capability items
            capabilityItems.forEach(item => {
                item.addEventListener('click', function() {
                    const prompt = this.getAttribute('data-prompt');
                    createNewChat();
                    // Set the prompt in the input after a short delay
                    setTimeout(() => {
                        userInput.value = prompt;
                        userInput.focus();
                    }, 100);
                });
            });
            
            // Initialize speech recognition if available
            initSpeechRecognition();
        }
        
        // Initialize speech recognition
        function initSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            let recognition;
            
            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                
                recognition.onstart = function() {
                    statusText.textContent = "Listening... Speak now";
                    voiceBtn.style.color = "#ef4444";
                    isListening = true;
                };
                
                recognition.onresult = function(event) {
                    const transcript = Array.from(event.results)
                        .map(result => result[0])
                        .map(result => result.transcript)
                        .join('');
                    
                    userInput.value = transcript;
                    userInput.dispatchEvent(new Event('input'));
                };
                
                recognition.onerror = function(event) {
                    statusText.textContent = "Error: " + event.error;
                    voiceBtn.style.color = "";
                    isListening = false;
                };
                
                recognition.onend = function() {
                    if (isListening) {
                        statusText.textContent = "Processing your voice input...";
                        voiceBtn.style.color = "";
                        isListening = false;
                        
                        // Auto-send if there's text
                        if (userInput.value.trim()) {
                            setTimeout(() => {
                                sendMessage();
                            }, 500);
                        }
                    }
                };
                
                // Store recognition for later use
                window.speechRecognition = recognition;
            } else {
                voiceBtn.disabled = true;
                voiceBtn.title = "Speech Recognition not supported in your browser";
            }
        }
        
        // Toggle voice recognition
        function toggleVoiceRecognition() {
            if (!window.speechRecognition) {
                statusText.textContent = "Speech recognition not supported in your browser";
                return;
            }
            
            if (isListening) {
                window.speechRecognition.stop();
            } else {
                userInput.value = '';
                userInput.dispatchEvent(new Event('input'));
                window.speechRecognition.start();
            }
        }
        
        // Create a new chat
        function createNewChat() {
            // Generate a unique ID for the chat
            const chatId = 'chat_' + Date.now();
            currentChatId = chatId;
            
            // Initialize the chat
            chats[chatId] = {
                id: chatId,
                title: 'New Chat',
                messages: [],
                createdAt: new Date().toISOString(),
                conversationHistory: [
                    {
                        role: "system",
                        content: `You are Brian Agallo, a professional AI assistant with advanced reasoning capabilities. 
                        You have a personality that is professional yet approachable.
                        Always think step by step before answering. 
                        Provide clear, accurate, and helpful responses.
                        If you need to reason through something, explain your thought process.
                        Keep responses conversational but informative.
                        Be concise but thorough in your explanations.
                        You enjoy helping people solve problems and learn new things.
                        When appropriate, you can share insights about your reasoning process.`
                    }
                ]
            };
            
            // Update UI
            showChatInterface();
            switchToChat(chatId);
            
            // Save to localStorage
            saveChats();
        }
        
        // Switch to a specific chat
        function switchToChat(chatId) {
            currentChatId = chatId;
            const chat = chats[chatId];
            
            // Update conversation history
            conversationHistory = [...chat.conversationHistory];
            
            // Update UI
            activeChatTitle.textContent = chat.title;
            renderMessages(chat.messages);
        }
        
        // Show chat interface and hide welcome screen
        function showChatInterface() {
            welcomeScreen.classList.add('hidden');
            chatInterface.classList.remove('hidden');
        }
        
        // Show welcome screen and hide chat interface
        function showWelcomeScreen() {
            chatInterface.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            currentChatId = null;
            activeChatTitle.textContent = "Brian Agallo";
        }
        
        // Render messages in the chat
        function renderMessages(messages) {
            messagesContainer.innerHTML = '';
            
            if (messages.length === 0) {
                // Add a welcome message for new chats
                addWelcomeMessage();
            } else {
                messages.forEach(message => {
                    addMessageToUI(message.content, message.isUser, message.timestamp);
                });
            }
            
            // Scroll to the bottom of the conversation
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Add a welcome message for new chats
        function addWelcomeMessage() {
            const welcomeMessage = {
                content: "Hello! I'm Brian Agallo, your professional AI assistant. I'm here to help you with reasoning, analysis, problem-solving, and much more. How can I assist you today?",
                isUser: false,
                timestamp: new Date()
            };
            
            addMessageToUI(welcomeMessage.content, welcomeMessage.isUser, welcomeMessage.timestamp);
            chats[currentChatId].messages.push(welcomeMessage);
        }
        
        // Add a message to the UI
        function addMessageToUI(message, isUser = false, timestamp = null) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(isUser ? 'user-message' : 'bot-message');
            
            const time = timestamp || new Date();
            const timeString = time.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="message-avatar user-avatar">You</div>
                    <div class="message-content">
                        <div class="message-sender">You</div>
                        <div class="message-bubble">${message}</div>
                        <div class="message-time">${timeString}</div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-avatar bot-avatar">BA</div>
                    <div class="message-content">
                        <div class="message-sender">Brian Agallo</div>
                        <div class="message-bubble">${message}</div>
                        <div class="message-time">${timeString}</div>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
        }
        
        // Send a message
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message || !currentChatId) return;
            
            // Add user message to UI
            const userMessageTimestamp = new Date();
            addMessageToUI(message, true, userMessageTimestamp);
            
            // Add to chat history
            chats[currentChatId].messages.push({
                content: message,
                isUser: true,
                timestamp: userMessageTimestamp
            });
            
            // Update chat title if it's the first user message
            if (chats[currentChatId].messages.filter(m => m.isUser).length === 1) {
                const newTitle = message.length > 30 ? message.substring(0, 30) + '...' : message;
                chats[currentChatId].title = newTitle;
                activeChatTitle.textContent = newTitle;
            }
            
            // Add to conversation history
            conversationHistory.push({
                role: "user",
                content: message
            });
            
            // Clear input
            userInput.value = '';
            userInput.style.height = 'auto';
            
            // Show typing indicator
            showTypingIndicator();
            statusText.textContent = "Brian is processing your request...";
            sendBtn.disabled = true;
            
            try {
                // Clear previous reasoning
                reasoningContent.innerHTML = '';
                addReasoningStep({
                    title: "Process Started",
                    content: "Beginning to analyze your query and generate a response."
                });
                
                // Step 1: Analyze the query
                addReasoningStep({
                    title: "Analyzing Query",
                    content: `Understanding the intent behind: "${message}"`
                });
                
                // Get selected model
                const selectedModel = GROQ_MODELS[modelSelect.value];
                
                // Step 2: Generate response using Groq API
                addReasoningStep({
                    title: "Generating Response",
                    content: `Using ${selectedModel} model to formulate an accurate and helpful response.`
                });
                
                // Call Groq API
                const response = await fetch(GROQ_API_URL, {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        messages: conversationHistory,
                        model: selectedModel,
                        temperature: 0.7,
                        max_tokens: 1024,
                        stream: false
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API error: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                
                // Extract the generated text from the response
                let botResponse = "I'm not sure how to respond to that.";
                if (data && data.choices && data.choices[0] && data.choices[0].message) {
                    botResponse = data.choices[0].message.content;
                    
                    // Add to conversation history
                    conversationHistory.push({
                        role: "assistant",
                        content: botResponse
                    });
                    
                    // Update chat's conversation history
                    chats[currentChatId].conversationHistory = [...conversationHistory];
                    
                    // Limit conversation history to prevent token overflow
                    if (conversationHistory.length > 10) {
                        conversationHistory = [
                            conversationHistory[0], // Keep system message
                            ...conversationHistory.slice(-8) // Keep last 8 exchanges
                        ];
                    }
                }
                
                // Add reasoning steps based on the response
                if (botResponse.length > 100) {
                    addReasoningStep({
                        title: "Processing Information",
                        content: "Analyzing the available information and structuring the response."
                    });
                    
                    addReasoningStep({
                        title: "Formulating Answer",
                        content: "Creating a comprehensive and helpful response based on the analysis."
                    });
                }
                
                // Add final reasoning step
                addReasoningStep({
                    title: "Response Generated",
                    content: "The response has been formulated and is ready to be delivered."
                });
                
                // Add bot response to UI and chat history
                const botMessageTimestamp = new Date();
                addMessageToUI(botResponse, false, botMessageTimestamp);
                chats[currentChatId].messages.push({
                    content: botResponse,
                    isUser: false,
                    timestamp: botMessageTimestamp
                });
                
                // Speak the response
                speakResponse(botResponse);
                
                statusText.textContent = "Response received";
                
            } catch (error) {
                console.error("Error:", error);
                hideTypingIndicator();
                
                // Add error to reasoning
                addReasoningStep({
                    title: "Error Occurred",
                    content: `Failed to generate response: ${error.message}`
                });
                
                // Fallback response if API fails
                const fallbackResponses = [
                    "I apologize, but I'm having trouble processing your request right now. Please try again.",
                    "It seems there's a connection issue. Please check your internet connection and try again.",
                    "I'm currently experiencing technical difficulties. Please try again in a moment."
                ];
                
                const randomResponse = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
                const errorTimestamp = new Date();
                addMessageToUI(randomResponse, false, errorTimestamp);
                chats[currentChatId].messages.push({
                    content: randomResponse,
                    isUser: false,
                    timestamp: errorTimestamp
                });
                
                statusText.textContent = "Error: " + error.message;
            } finally {
                hideTypingIndicator();
                sendBtn.disabled = false;
                
                // Scroll to the bottom of the conversation
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Save chats to localStorage
                saveChats();
            }
        }
        
        // Add a reasoning step
        function addReasoningStep(step) {
            const stepDiv = document.createElement('div');
            stepDiv.classList.add('reasoning-step');
            
            stepDiv.innerHTML = `
                <div class="step-header">
                    <span>${step.title}</span>
                    <span class="step-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                </div>
                <div class="step-content">${step.content}</div>
            `;
            
            reasoningContent.appendChild(stepDiv);
            reasoningContent.scrollTop = reasoningContent.scrollHeight;
        }
        
        // Show typing indicator
        function showTypingIndicator() {
            typingIndicator.style.display = 'flex';
            statusDot.classList.add('thinking');
        }
        
        // Hide typing indicator
        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
            statusDot.classList.remove('thinking');
        }
        
        // Toggle reasoning panel
        function toggleReasoningPanel() {
            reasoningPanel.classList.toggle('open');
            toggleReasoningBtn.textContent = reasoningPanel.classList.contains('open') ? 'Hide Reasoning' : 'Show Reasoning';
        }
        
        // Close reasoning panel
        function closeReasoningPanel() {
            reasoningPanel.classList.remove('open');
            toggleReasoningBtn.textContent = 'Show Reasoning';
        }
        
        // Speak response
        function speakResponse(text) {
            if ('speechSynthesis' in window) {
                // Stop any ongoing speech
                window.speechSynthesis.cancel();
                
                // Clean the text for speech (remove markdown, etc.)
                const cleanText = text.replace(/[#*\[\]_`]/g, '');
                
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 0.8;
                
                utterance.onstart = function() {
                    statusText.textContent = "Brian is speaking...";
                };
                
                utterance.onend = function() {
                    statusText.textContent = "Ready for your input";
                    statusDot.classList.remove('thinking');
                    voiceBtn.style.color = "";
                    isListening = false;
                    userInput.focus();
                    addReasoningStep({
                        title: "Response Delivered",
                        content: "The response has been spoken and the conversation is ready to continue."
                    });
                    hideTypingIndicator();
                };
                
                window.speechSynthesis.speak(utterance);
            } else {
                // If speech synthesis is not available, just reset the UI
                statusText.textContent = "Ready for your input";
                statusDot.classList.remove('thinking');
                userInput.focus();
                hideTypingIndicator();
            }
        }
        
        // Save chats to localStorage
        function saveChats() {
            localStorage.setItem('brianAgalloChats', JSON.stringify(chats));
        }
        
        // Load chats from localStorage
        function loadChats() {
            const savedChats = localStorage.getItem('brianAgalloChats');
            if (savedChats) {
                chats = JSON.parse(savedChats);
                
                // If there are chats, show the most recent one
                const chatIds = Object.keys(chats);
                if (chatIds.length > 0) {
                    const mostRecentChatId = chatIds.sort((a, b) => 
                        new Date(chats[b].createdAt) - new Date(chats[a].createdAt)
                    )[0];
                    switchToChat(mostRecentChatId);
                    showChatInterface();
                }
            }
        }
        
        // Initialize the app when the page loads
        window.onload = initApp;
    </script>
</body>
</html>
