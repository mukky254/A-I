<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brian Agallo - AI Assistant with Voice Chat</title>
    <style>
        :root {
            --primary: #10a37f;
            --primary-dark: #0d8c6c;
            --sidebar: #202123;
            --chat-bg: #343541;
            --message-user: #444654;
            --message-bot: #343541;
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --border: #4b5563;
            --input-bg: #40414f;
            --user-bubble: #10a37f;
            --bot-bubble: #565869;
            --voice-active: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background-color: var(--chat-bg);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background-color: var(--sidebar);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
        }
        
        .new-chat-btn {
            margin: 12px;
            padding: 12px;
            background-color: transparent;
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
        }
        
        .new-chat-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .new-chat-btn i {
            font-size: 16px;
        }
        
        .history {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }
        
        .history-item {
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 4px;
            color: var(--text-secondary);
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .sidebar-footer {
            padding: 12px;
            border-top: 1px solid var(--border);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .user-info:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            background: linear-gradient(135deg, var(--primary), #2563eb);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        /* Main Chat Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .chat-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .model-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .model-selector select {
            background-color: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 14px;
            outline: none;
        }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .message {
            display: flex;
            max-width: 100%;
            line-height: 1.6;
        }
        
        .user-message {
            justify-content: flex-end;
        }
        
        .bot-message {
            justify-content: flex-start;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            margin: 0 8px;
        }
        
        .user-avatar {
            background: linear-gradient(135deg, #10a37f, #0d8c6c);
        }
        
        .bot-avatar {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }
        
        .user-message .message-content {
            background-color: var(--user-bubble);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .bot-message .message-content {
            background-color: var(--bot-bubble);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }
        
        .message-sender {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* Input Area */
        .input-container {
            padding: 24px;
            position: relative;
        }
        
        .input-wrapper {
            position: relative;
            max-width: 768px;
            margin: 0 auto;
        }
        
        .user-input {
            width: 100%;
            padding: 16px 48px 16px 16px;
            background-color: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
            resize: none;
            outline: none;
            line-height: 1.5;
            max-height: 200px;
            min-height: 56px;
        }
        
        .user-input:focus {
            border-color: var(--primary);
        }
        
        .input-buttons {
            position: absolute;
            right: 12px;
            bottom: 12px;
            display: flex;
            gap: 8px;
        }
        
        .input-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .input-btn:hover {
            color: var(--text-primary);
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .send-btn {
            background-color: var(--primary);
            color: white;
        }
        
        .send-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .send-btn:disabled {
            background-color: var(--border);
            cursor: not-allowed;
        }
        
        /* Voice Controls */
        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 16px;
        }
        
        .voice-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background-color: var(--input-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .voice-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .voice-btn.active {
            background-color: var(--voice-active);
            color: white;
        }
        
        .voice-btn i {
            font-size: 24px;
        }
        
        .voice-btn-text {
            font-size: 14px;
        }
        
        /* Voice Visualization */
        .voice-visualizer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
            margin-top: 8px;
            height: 20px;
        }
        
        .voice-bar {
            width: 4px;
            height: 4px;
            background-color: var(--text-muted);
            border-radius: 2px;
            transition: height 0.1s ease;
        }
        
        .voice-bar.active {
            background-color: var(--voice-active);
        }
        
        /* Reasoning Panel */
        .reasoning-panel {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 320px;
            background-color: var(--sidebar);
            border-left: 1px solid var(--border);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .reasoning-panel.open {
            transform: translateX(0);
        }
        
        .reasoning-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .reasoning-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .close-reasoning {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }
        
        .close-reasoning:hover {
            color: var(--text-primary);
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .reasoning-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .reasoning-step {
            margin-bottom: 16px;
            padding: 12px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .step-time {
            color: var(--text-muted);
            font-size: 12px;
        }
        
        .step-content {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        /* Status and Typing Indicators */
        .status-bar {
            padding: 8px 24px;
            background-color: var(--sidebar);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-muted);
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--primary);
        }
        
        .status-dot.thinking {
            background-color: #f59e0b;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-muted);
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--text-muted);
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        .toggle-reasoning {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .toggle-reasoning:hover {
            color: var(--text-primary);
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                left: -260px;
                z-index: 10;
                transition: left 0.3s ease;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .reasoning-panel {
                width: 100%;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .voice-controls {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <button class="new-chat-btn">
                <i>+</i> New Chat
            </button>
            <div class="history">
                <div class="history-item">Discussing AI ethics and future implications</div>
                <div class="history-item">Planning a machine learning project roadmap</div>
                <div class="history-item">Exploring quantum computing applications</div>
                <div class="history-item">Brainstorming startup ideas in tech</div>
            </div>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">BA</div>
                    <div>
                        <div style="font-weight: 600;">Brian Agallo</div>
                        <div style="font-size: 12px; color: var(--text-muted);">AI Assistant</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="main-content">
            <div class="chat-header">
                <div class="chat-title">Brian Agallo</div>
                <div class="model-selector">
                    <label>Model:</label>
                    <select id="model-select">
                        <option value="llama-3.1-8b-instant">Llama 3.1 8B Instant</option>
                        <option value="llama-3.1-70b-versatile">Llama 3.1 70B Versatile</option>
                        <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                        <option value="gemma2-9b-it">Gemma2 9B</option>
                    </select>
                </div>
            </div>
            
            <div class="messages-container" id="messages-container">
                <div class="message bot-message">
                    <div class="message-avatar bot-avatar">BA</div>
                    <div class="message-content">
                        <div class="message-sender">Brian Agallo</div>
                        <div>Hello! I'm Brian Agallo, your professional AI assistant. I'm here to help you with reasoning, analysis, problem-solving, and much more. You can chat with me using text or voice!</div>
                    </div>
                </div>
            </div>
            
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea class="user-input" id="user-input" placeholder="Message Brian Agallo..." rows="1"></textarea>
                    <div class="input-buttons">
                        <button class="input-btn" id="voice-input-btn" title="Voice Input">
                            <i>üé§</i>
                        </button>
                        <button class="input-btn send-btn" id="send-btn">
                            <i>‚Üë</i>
                        </button>
                    </div>
                </div>
                
                <!-- Voice Controls -->
                <div class="voice-controls">
                    <button class="voice-btn" id="start-voice-btn">
                        <i>üé§</i>
                        <span class="voice-btn-text">Start Voice Chat</span>
                    </button>
                    <button class="voice-btn" id="stop-voice-btn" disabled>
                        <i>‚èπÔ∏è</i>
                        <span class="voice-btn-text">Stop Voice</span>
                    </button>
                    <button class="voice-btn" id="toggle-speech-btn">
                        <i>üîä</i>
                        <span class="voice-btn-text">Speech: ON</span>
                    </button>
                </div>
                
                <!-- Voice Visualization -->
                <div class="voice-visualizer" id="voice-visualizer" style="display: none;">
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                </div>
            </div>
            
            <div class="status-bar">
                <div class="status">
                    <div class="status-dot" id="status-dot"></div>
                    <span id="status-text">Ready for your input</span>
                </div>
                <div class="typing-indicator" id="typing-indicator" style="display: none;">
                    <span>Brian is thinking</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
                <button class="toggle-reasoning" id="toggle-reasoning">Show Reasoning</button>
            </div>
        </div>
        
        <!-- Reasoning Panel -->
        <div class="reasoning-panel" id="reasoning-panel">
            <div class="reasoning-header">
                <div class="reasoning-title">
                    <i>üß†</i> Brian's Reasoning Process
                </div>
                <button class="close-reasoning" id="close-reasoning">√ó</button>
            </div>
            <div class="reasoning-content" id="reasoning-content">
                <div class="reasoning-step">
                    <div class="step-header">
                        <span>System Initialized</span>
                        <span class="step-time" id="current-time"></span>
                    </div>
                    <div class="step-content">Brian Agallo is ready. Waiting for user input to begin reasoning process.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const messagesContainer = document.getElementById('messages-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const voiceInputBtn = document.getElementById('voice-input-btn');
        const startVoiceBtn = document.getElementById('start-voice-btn');
        const stopVoiceBtn = document.getElementById('stop-voice-btn');
        const toggleSpeechBtn = document.getElementById('toggle-speech-btn');
        const voiceVisualizer = document.getElementById('voice-visualizer');
        const statusText = document.getElementById('status-text');
        const statusDot = document.getElementById('status-dot');
        const typingIndicator = document.getElementById('typing-indicator');
        const reasoningContent = document.getElementById('reasoning-content');
        const reasoningPanel = document.getElementById('reasoning-panel');
        const toggleReasoningBtn = document.getElementById('toggle-reasoning');
        const closeReasoningBtn = document.getElementById('close-reasoning');
        const currentTimeEl = document.getElementById('current-time');
        const modelSelect = document.getElementById('model-select');
        
        // Voice settings
        let isSpeechEnabled = true;
        let isVoiceActive = false;
        let voiceBars = [];
        
        // Update current time
        function updateTime() {
            const now = new Date();
            currentTimeEl.textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        setInterval(updateTime, 1000);
        updateTime();
        
        // API Configuration for Groq
        const GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions";
        const API_KEY = "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";
        
        // Available Groq Models
        const GROQ_MODELS = {
            "llama-3.1-8b-instant": "llama-3.1-8b-instant",
            "llama-3.1-70b-versatile": "llama-3.1-70b-versatile", 
            "mixtral-8x7b-32768": "mixtral-8x7b-32768",
            "gemma2-9b-it": "gemma2-9b-it"
        };
        
        // Conversation history
        let conversationHistory = [
            {
                role: "system",
                content: `You are Brian Agallo, a professional AI assistant with advanced reasoning capabilities. 
                You have a personality that is professional yet approachable.
                Always think step by step before answering. 
                Provide clear, accurate, and helpful responses.
                If you need to reason through something, explain your thought process.
                Keep responses conversational but informative.
                Be concise but thorough in your explanations.
                You enjoy helping people solve problems and learn new things.
                When appropriate, you can share insights about your reasoning process.`
            }
        ];
        
        // Initialize voice visualization bars
        function initializeVoiceVisualizer() {
            voiceBars = Array.from(voiceVisualizer.querySelectorAll('.voice-bar'));
        }
        
        // Update voice visualization
        function updateVoiceVisualization(volume) {
            if (!isVoiceActive) return;
            
            voiceBars.forEach((bar, index) => {
                const shouldBeActive = index < Math.floor(volume / 10);
                if (shouldBeActive) {
                    bar.classList.add('active');
                    bar.style.height = `${10 + (index * 5)}px`;
                } else {
                    bar.classList.remove('active');
                    bar.style.height = '4px';
                }
            });
        }
        
        // Auto-resize textarea
        userInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
        
        // Speech Recognition Setup
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        let isListening = false;
        
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
            
            recognition.onstart = function() {
                statusText.textContent = "Listening... Speak now";
                voiceInputBtn.style.color = "#ef4444";
                startVoiceBtn.classList.add('active');
                stopVoiceBtn.disabled = false;
                isListening = true;
                isVoiceActive = true;
                voiceVisualizer.style.display = 'flex';
            };
            
            recognition.onresult = function(event) {
                const transcript = Array.from(event.results)
                    .map(result => result[0])
                    .map(result => result.transcript)
                    .join('');
                
                userInput.value = transcript;
                userInput.dispatchEvent(new Event('input'));
                
                // Simulate voice visualization based on transcript length
                const volume = Math.min(100, transcript.length * 2);
                updateVoiceVisualization(volume);
            };
            
            recognition.onerror = function(event) {
                console.error("Speech recognition error:", event.error);
                statusText.textContent = "Error: " + event.error;
                voiceInputBtn.style.color = "";
                startVoiceBtn.classList.remove('active');
                stopVoiceBtn.disabled = true;
                isListening = false;
                isVoiceActive = false;
                voiceVisualizer.style.display = 'none';
            };
            
            recognition.onend = function() {
                if (isListening) {
                    statusText.textContent = "Processing your voice input...";
                    voiceInputBtn.style.color = "";
                    startVoiceBtn.classList.remove('active');
                    stopVoiceBtn.disabled = true;
                    isListening = false;
                    isVoiceActive = false;
                    voiceVisualizer.style.display = 'none';
                    
                    // Auto-send if there's text
                    if (userInput.value.trim()) {
                        setTimeout(() => {
                            sendMessage();
                        }, 500);
                    }
                }
            };
        } else {
            voiceInputBtn.disabled = true;
            startVoiceBtn.disabled = true;
            voiceInputBtn.title = "Speech Recognition not supported in your browser";
            startVoiceBtn.title = "Speech Recognition not supported in your browser";
        }
        
        // Event Listeners
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        voiceInputBtn.addEventListener('click', toggleVoiceRecognition);
        startVoiceBtn.addEventListener('click', startVoiceRecognition);
        stopVoiceBtn.addEventListener('click', stopVoiceRecognition);
        toggleSpeechBtn.addEventListener('click', toggleSpeech);
        toggleReasoningBtn.addEventListener('click', toggleReasoningPanel);
        closeReasoningBtn.addEventListener('click', closeReasoningPanel);
        
        // Functions
        function toggleVoiceRecognition() {
            if (!SpeechRecognition) {
                statusText.textContent = "Speech recognition not supported in your browser";
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                userInput.value = '';
                userInput.dispatchEvent(new Event('input'));
                recognition.start();
            }
        }
        
        function startVoiceRecognition() {
            if (!SpeechRecognition) {
                statusText.textContent = "Speech recognition not supported in your browser";
                return;
            }
            
            userInput.value = '';
            userInput.dispatchEvent(new Event('input'));
            recognition.start();
        }
        
        function stopVoiceRecognition() {
            if (isListening) {
                recognition.stop();
            }
        }
        
        function toggleSpeech() {
            isSpeechEnabled = !isSpeechEnabled;
            toggleSpeechBtn.querySelector('.voice-btn-text').textContent = 
                `Speech: ${isSpeechEnabled ? 'ON' : 'OFF'}`;
            toggleSpeechBtn.style.backgroundColor = isSpeechEnabled ? '' : 'var(--text-muted)';
        }
        
        function toggleReasoningPanel() {
            reasoningPanel.classList.toggle('open');
            toggleReasoningBtn.textContent = reasoningPanel.classList.contains('open') ? 'Hide Reasoning' : 'Show Reasoning';
        }
        
        function closeReasoningPanel() {
            reasoningPanel.classList.remove('open');
            toggleReasoningBtn.textContent = 'Show Reasoning';
        }
        
        function addMessage(message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(isUser ? 'user-message' : 'bot-message');
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <div class="message-sender">You</div>
                        <div>${message}</div>
                    </div>
                    <div class="message-avatar user-avatar">You</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-avatar bot-avatar">BA</div>
                    <div class="message-content">
                        <div class="message-sender">Brian Agallo</div>
                        <div>${message}</div>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function addReasoningStep(step) {
            const stepDiv = document.createElement('div');
            stepDiv.classList.add('reasoning-step');
            
            stepDiv.innerHTML = `
                <div class="step-header">
                    <span>${step.title}</span>
                    <span class="step-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                </div>
                <div class="step-content">${step.content}</div>
            `;
            
            reasoningContent.appendChild(stepDiv);
            reasoningContent.scrollTop = reasoningContent.scrollHeight;
        }
        
        function showTypingIndicator() {
            typingIndicator.style.display = 'flex';
            statusDot.classList.add('thinking');
        }
        
        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
            statusDot.classList.remove('thinking');
        }
        
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // Add user message to chat
            addMessage(message, true);
            userInput.value = '';
            userInput.style.height = 'auto';
            
            // Add to conversation history
            conversationHistory.push({
                role: "user",
                content: message
            });
            
            // Show typing indicator
            showTypingIndicator();
            statusText.textContent = "Brian is processing your request...";
            sendBtn.disabled = true;
            
            try {
                // Clear previous reasoning
                reasoningContent.innerHTML = '';
                addReasoningStep({
                    title: "Process Started",
                    content: "Beginning to analyze your query and generate a response."
                });
                
                // Step 1: Analyze the query
                addReasoningStep({
                    title: "Analyzing Query",
                    content: `Understanding the intent behind: "${message}"`
                });
                
                // Get selected model
                const selectedModel = GROQ_MODELS[modelSelect.value];
                
                // Step 2: Generate response using Groq API
                addReasoningStep({
                    title: "Generating Response",
                    content: `Using ${selectedModel} model to formulate an accurate and helpful response.`
                });
                
                // Call Groq API
                const response = await fetch(GROQ_API_URL, {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        messages: conversationHistory,
                        model: selectedModel,
                        temperature: 0.7,
                        max_tokens: 1024,
                        stream: false
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API error: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                
                // Extract the generated text from the response
                let botResponse = "I'm not sure how to respond to that.";
                if (data && data.choices && data.choices[0] && data.choices[0].message) {
                    botResponse = data.choices[0].message.content;
                    
                    // Add to conversation history
                    conversationHistory.push({
                        role: "assistant",
                        content: botResponse
                    });
                    
                    // Limit conversation history to prevent token overflow
                    if (conversationHistory.length > 10) {
                        conversationHistory = [
                            conversationHistory[0], // Keep system message
                            ...conversationHistory.slice(-8) // Keep last 8 exchanges
                        ];
                    }
                }
                
                // Add reasoning steps based on the response
                if (botResponse.length > 100) {
                    addReasoningStep({
                        title: "Processing Information",
                        content: "Analyzing the available information and structuring the response."
                    });
                    
                    addReasoningStep({
                        title: "Formulating Answer",
                        content: "Creating a comprehensive and helpful response based on the analysis."
                    });
                }
                
                // Add final reasoning step
                addReasoningStep({
                    title: "Response Generated",
                    content: "The response has been formulated and is ready to be delivered."
                });
                
                // Add bot response to chat
                addMessage(botResponse);
                
                // Speak the response if enabled
                if (isSpeechEnabled) {
                    speakResponse(botResponse);
                } else {
                    statusText.textContent = "Response received";
                    hideTypingIndicator();
                    sendBtn.disabled = false;
                }
                
            } catch (error) {
                console.error("Error:", error);
                hideTypingIndicator();
                
                // Add error to reasoning
                addReasoningStep({
                    title: "Error Occurred",
                    content: `Failed to generate response: ${error.message}`
                });
                
                // Fallback response if API fails
                const fallbackResponses = [
                    "I apologize, but I'm having trouble processing your request right now. Please try again.",
                    "It seems there's a connection issue. Please check your internet connection and try again.",
                    "I'm currently experiencing technical difficulties. Please try again in a moment."
                ];
                
                const randomResponse = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
                addMessage(randomResponse);
                statusText.textContent = "Error: " + error.message;
                sendBtn.disabled = false;
            }
        }
        
        function speakResponse(text) {
            if ('speechSynthesis' in window) {
                // Stop any ongoing speech
                window.speechSynthesis.cancel();
                
                // Clean the text for speech (remove markdown, etc.)
                const cleanText = text.replace(/[#*\[\]_`]/g, '');
                
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 0.8;
                
                utterance.onstart = function() {
                    statusText.textContent = "Brian is speaking...";
                };
                
                utterance.onend = function() {
                    statusText.textContent = "Ready for your input";
                    statusDot.classList.remove('thinking');
                    voiceInputBtn.style.color = "";
                    isListening = false;
                    userInput.focus();
                    addReasoningStep({
                        title: "Response Delivered",
                        content: "The response has been spoken and the conversation is ready to continue."
                    });
                    hideTypingIndicator();
                    sendBtn.disabled = false;
                };
                
                utterance.onerror = function(event) {
                    console.error("Speech synthesis error:", event);
                    statusText.textContent = "Speech error, but response received";
                    hideTypingIndicator();
                    sendBtn.disabled = false;
                };
                
                window.speechSynthesis.speak(utterance);
            } else {
                // If speech synthesis is not available, just reset the UI
                statusText.textContent = "Ready for your input";
                statusDot.classList.remove('thinking');
                userInput.focus();
                hideTypingIndicator();
                sendBtn.disabled = false;
            }
        }
        
        // Initialize the voice visualizer
        initializeVoiceVisualizer();
        
        // Initialize with a welcome message
        window.onload = function() {
            setTimeout(() => {
                if ('speechSynthesis' in window && isSpeechEnabled) {
                    speakResponse("Hello! I'm Brian Agallo, your professional AI assistant. I'm here to help you with reasoning, analysis, problem-solving, and much more. You can chat with me using text or voice!");
                }
            }, 1000);
        };
    </script>
</body>
</html>
